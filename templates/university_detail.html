{% extends 'base.html' %}
{% load static %} {# If you use static files for CSS/JS later #}

{% block title %}{{ university.full_name }}{% endblock %}

{% block head %}
{# Add specific CSS or JS for this page if needed #}
<style>
    .detail-section { margin-bottom: 1.5rem; }
    .detail-label { font-weight: 600; color: #4b5563; /* gray-600 */ }
    .detail-value { color: #1f2937; /* gray-800 */ }
    .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px; /* rounded-full */
        font-size: 0.75rem; /* text-xs */
        font-weight: 500; /* font-medium */
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }
    .badge-gray { background-color: #e5e7eb; color: #374151; } /* gray-200 / gray-700 */
    .badge-blue { background-color: #dbeafe; color: #1d4ed8; } /* blue-100 / blue-700 */
    .badge-green { background-color: #d1fae5; color: #047857; } /* green-100 / green-700 */
    .badge-indigo { background-color: #e0e7ff; color: #4338ca; } /* indigo-100 / indigo-700 */

    /* Style for embedded HTML content */
    .html-content p { margin-bottom: 1rem; line-height: 1.6; }
    .html-content strong { font-weight: 600; }
    .html-content ul, .html-content ol { margin-left: 1.5rem; margin-bottom: 1rem; }
    .html-content li { margin-bottom: 0.5rem; }
    .html-content a { color: #2563eb; text-decoration: underline; } /* blue-600 */

</style>
{% endblock %}

{% block filters %}
    {# No filters on detail page, maybe related links? #}
    <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="text-md font-semibold mb-3">Sahifalar</h3>
        <ul class="space-y-2">
            <li><a href="{% url 'university_app:university_list' %}" class="text-blue-600 hover:underline">Universitetlar Ro'yxati</a></li>
            <li><a href="{% url 'university_app:direction_list' %}" class="text-blue-600 hover:underline">Yo'nalishlar Ro'yxati</a></li>
        </ul>
    </div>
{% endblock %}

{% block content %}
<div class="bg-white p-6 md:p-8 rounded-lg shadow">

    {# Header Section #}
    <div class="flex flex-col md:flex-row gap-6 items-start mb-6 border-b pb-6">
        <div class="flex-shrink-0 w-24 h-24 md:w-32 md:h-32 bg-gray-200 rounded-md flex items-center justify-center overflow-hidden">
            {% if university.logo %}
            <img src="/media/{{ university.logo }}" alt="{{ university.full_name }} logosi" class="max-h-full max-w-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'text-sm text-gray-500\'>Logo</span>';">
            {% else %}
            <span class="text-sm text-gray-500">Logo yo'q</span>
            {% endif %}
        </div>
        <div class="flex-grow">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">{{ university.full_name }}</h1>
            {% if university.location %}
            <p class="text-md text-gray-600 mb-1"><span class="detail-label">Manzil:</span> {{ university.location.name }}</p>
            {% endif %}
             {% if university.institution_category %}
            <p class="text-md text-gray-600 mb-3"><span class="detail-label">Turi:</span> {{ university.institution_category.name }}</p>
            {% endif %}
             {# Add website link if available #}
             {% if university.web_site %}
                 <a href="{{ university.web_site }}" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 text-white py-2 px-4 rounded-md text-sm hover:bg-blue-700 transition duration-150">
                     Veb-saytga o'tish
                 </a>
             {% endif %}
        </div>
    </div>

    {# Main Details Section #}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        {# Left Column #}
        <div>
            {% if university.address %}
            <div class="detail-section">
                <p class="detail-label">To'liq Manzil:</p>
                <p class="detail-value">{{ university.address }}</p>
            </div>
            {% endif %}

            {% if university.founded_year %}
            <div class="detail-section">
                <p class="detail-label">Tashkil etilgan yili:</p>
                {# Attempt to format date nicely, fallback to original string #}
                <p class="detail-value">{{ university.founded_year|date:"Y"|default:university.founded_year }}</p>
            </div>
            {% endif %}

             {% if university.students_count %}
            <div class="detail-section">
                <p class="detail-label">Talabalar soni:</p>
                <p class="detail-value">{{ university.students_count|floatformat:"0" }}</p>
            </div>
            {% endif %}

            {% if university.admission_phone %}
            <div class="detail-section">
                <p class="detail-label">Qabul telefoni:</p>
                <p class="detail-value">{{ university.admission_phone }}</p>
            </div>
            {% endif %}

             {% if university.support_email %}
            <div class="detail-section">
                <p class="detail-label">Email:</p>
                <p class="detail-value"><a href="mailto:{{ university.support_email }}" class="text-blue-600 hover:underline">{{ university.support_email }}</a></p>
            </div>
            {% endif %}

            <div class="detail-section">
                <p class="detail-label">Xususiyatlar:</p>
                <div class="mt-1">
                    {% if university.has_grant %}
                        <span class="badge badge-green">Grant mavjud</span>
                    {% else %}
                         <span class="badge badge-gray">Grant yo'q</span>
                    {% endif %}
                    {% if university.has_accomodation %}
                        <span class="badge badge-indigo">Yotoqxona mavjud</span>
                     {% else %}
                         <span class="badge badge-gray">Yotoqxona yo'q</span>
                    {% endif %}
                     {% if university.is_open_for_admission %}
                        <span class="badge badge-green">Qabul ochiq</span>
                     {% else %}
                         <span class="badge badge-gray">Qabul yopiq</span>
                    {% endif %}
                </div>
            </div>


        </div>

        {# Right Column #}
        <div>
             {% if university.minimal_tuition_fee is not None or university.maximal_tuition_fee is not None %}
             <div class="detail-section">
                <p class="detail-label">Kontrakt Narxi (taxminiy):</p>
                <p class="detail-value">
                    {% if university.minimal_tuition_fee is not None %}
                        {{ university.minimal_tuition_fee|floatformat:"0" }} so'm dan
                    {% endif %}
                    {% if university.maximal_tuition_fee is not None and university.minimal_tuition_fee != university.maximal_tuition_fee %}
                         {{ university.maximal_tuition_fee|floatformat:"0" }} so'm gacha
                    {% elif university.maximal_tuition_fee is not None and university.minimal_tuition_fee is None %}
                         {{ university.maximal_tuition_fee|floatformat:"0" }} so'm gacha
                    {% endif %}
                </p>
            </div>
            {% endif %}

             {% if university.admission_start_date or university.admission_deadline %}
            <div class="detail-section">
                <p class="detail-label">Qabul Muddatlari:</p>
                <p class="detail-value">
                    {% if university.admission_start_date %}
                        Boshlanish: {{ university.admission_start_date|date:"d-M, Y"|default:university.admission_start_date }}<br>
                    {% endif %}
                     {% if university.admission_deadline %}
                        Tugash: {{ university.admission_deadline|date:"d-M, Y"|default:university.admission_deadline }}
                    {% endif %}
                </p>
            </div>
            {% endif %}

            {% if university.education_types.all %}
            <div class="detail-section">
                <p class="detail-label">Ta'lim Turlari:</p>
                 <div class="mt-1">
                    {% for type in university.education_types.all %}
                        <span class="badge badge-gray">{{ type.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

             {% if university.education_languages.all %}
            <div class="detail-section">
                <p class="detail-label">Ta'lim Tillari:</p>
                 <div class="mt-1">
                    {% for lang in university.education_languages.all %}
                        <span class="badge badge-blue">{{ lang.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

             {% if university.degrees.all %}
            <div class="detail-section">
                <p class="detail-label">Darajalar:</p>
                 <div class="mt-1">
                    {% for degree in university.degrees.all %}
                        <span class="badge badge-gray">{{ degree.name }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

             {# Social Media Links #}
             <div class="detail-section">
                 <p class="detail-label">Ijtimoiy tarmoqlar:</p>
                 <div class="flex space-x-3 mt-1">
                    {% if university.telegram_username %}
                    <a href="{{ university.telegram_username }}" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700">Telegram</a>
                    {% endif %}
                     {% if university.instagram_username %}
                    <a href="{{ university.instagram_username }}" target="_blank" rel="noopener noreferrer" class="text-pink-600 hover:text-pink-800">Instagram</a>
                    {% endif %}
                     {% if university.facebook_username %}
                    <a href="{{ university.facebook_username }}" target="_blank" rel="noopener noreferrer" class="text-blue-800 hover:text-blue-900">Facebook</a>
                    {% endif %}
                    {% if university.youtube_username %}
                    <a href="{{ university.youtube_username }}" target="_blank" rel="noopener noreferrer" class="text-red-600 hover:text-red-800">YouTube</a>
                    {% endif %}
                 </div>
             </div>

        </div>
    </div>

    {# Description Section #}
    {% if university.description %}
    <div class="detail-section border-t pt-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-3">Universitet Haqida</h2>
        <div class="prose max-w-none text-gray-700 html-content"> {# Basic prose styling for HTML #}
            {{ university.description|safe }} {# Use |safe filter for HTML content #}
        </div>
    </div>
    {% endif %}

     {# Grant Information Section #}
    {% if university.has_grant and university.about_grant %}
    <div class="detail-section border-t pt-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-3">Grant Haqida</h2>
        <div class="prose max-w-none text-gray-700 html-content">
            {{ university.about_grant|safe }}
        </div>
    </div>
    {% endif %}

    {# Directions Section #}
    <div class="detail-section border-t pt-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Mavjud Yo'nalishlar ({{ directions.count }})</h2>
        {% if directions %}
            <div class="space-y-4">
                {% for direction in directions %}
                <div class="bg-gray-50 rounded-lg p-4 border hover:shadow-sm transition duration-200">
                     <h3 class="text-lg font-semibold text-blue-700 mb-1">
                         <a href="{% url 'university_app:direction_detail' slug=direction.direction_slug %}" class="hover:underline">
                            {{ direction.direction_name }}
                         </a>
                     </h3>
                     {% if direction.category %}
                     <p class="text-sm text-gray-600 mb-2">Kategoriya: {{ direction.category.name }}</p>
                     {% endif %}
                     <div class="flex flex-wrap gap-1 mb-2">
                         {% for type in direction.education_types.all %}
                             <span class="badge badge-gray">{{ type.name }}</span>
                         {% endfor %}
                     </div>
                      <div class="flex flex-wrap gap-1">
                         {% for lang in direction.education_languages.all %}
                             <span class="badge badge-blue">{{ lang.name }}</span>
                         {% endfor %}
                     </div>
                      {% if direction.has_stipend %}
                        <p class="text-xs text-green-600 font-medium mt-2">Stipendiya mavjud</p>
                     {% endif %}
                      <a href="{% url 'university_app:direction_detail' slug=direction.direction_slug %}" class="mt-3 inline-block text-blue-600 hover:underline text-sm font-medium">
                         Batafsil &rarr;
                      </a>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500">Bu universitet uchun hozircha yo'nalishlar qo'shilmagan.</p>
        {% endif %}
    </div>

     {# Add Map Section if latitude and longitude exist? #}
     {% if university.latitude and university.longitude %}
        {# Example: Placeholder for a map - requires JS library like Leaflet or Mapbox GL JS #}
        {# <div class="detail-section border-t pt-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-3">Xaritadagi joylashuvi</h2>
            <div id="map" style="height: 300px;" class="bg-gray-200 rounded"></div>
             Add JS for map initialization here
        </div> #}
     {% endif %}

</div>
{% endblock %}

{% block scripts %}
{# Add JavaScript for map initialization or other interactions if needed #}
{% endblock %}

